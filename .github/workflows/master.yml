# on:
#     push:
#         branches:
#             - main
# name: ğŸš€ Deploy website on push
# jobs:
#   web-deploy:
#     name: ğŸ‰ Deploy
#     runs-on: ubuntu-latest
#     defaults:
#         run:
#           working-directory: ./dist
#     steps:
#     - name: ğŸšš Get latest code
#       uses: actions/checkout@v4
    
#     - name: ğŸ“‚ Sync files
#       uses: SamKirkland/FTP-Deploy-Action@v4.3.5
#       with:
#         server: ftp.eklipes.in
#         username: ayush@eklipes.in
#         password: ${{ secrets.ftp_password }}
#         local-dir: dist/
#         server-dir: public_html/

name: Deploy to cPanel using FTP

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ğŸšš Get latest code
      uses: actions/checkout@v3

    - name: ğŸ”¨ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 16
        cache: 'yarn'

    - name: ğŸ”¨ Install dependencies and build the app
      run: yarn && yarn build

    # - name: ğŸ“‚ Copy "api" folder to "dist/api/"
    #   run: cp -r api dist/

    - name: ğŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ftp.eklipes.in
        username: dist@eklipes.in
        password: ${{ secrets.ftp_password }}
        local-dir: dist/
        exclude: |
          */.git
          .env
          package.json
          postcss.config.js
          tailwind.config.js
          .gitignore
          .github/**

    - name: ğŸ§¹ Clean up build files
      run: rm -rf build/